{% extends "base.html" %}


{% block content %}
<div class="row">
    <div class="box">
        <div class="box-title">
            <h2>{{post.subject}}</h2>
            <div class="text-muted post-date pull-right"><i class="fa fa-clock-o" aria-hidden="true"></i>{{post.created.strftime("%b %d, %Y")}}</div>
        </div>
    <!-- </div> -->
        <div class="box-content">
            <div class="row">
                <div class="col-10">
                    <div class="post-content">
                        <pre class="post-content">{{post.content | safe }}</pre>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="row">
    <div class="post-buttons">
        <div class="btn-group">
            <a href="/{{post.key.id()}}/edit" class="btn-link">
                <button class="btn btn-white"><i class="fa fa-pencil" aria-hidden="true"></i>Edit</button>
            </a>
            <!-- <a href="/{{post.key.id()}}/delete" class="btn-link">
                <button class="btn btn-white" name="delete-post" data-id="{{post.key.id()}}"><i class="fa fa-trash-o" aria-hidden="true"></i> Delete</button>
            </a> -->
            <button class="btn btn-white" name="delete-post" data-id="{{post.key.id()}}"><i class="fa fa-trash-o" aria-hidden="true"></i> Delete</button>
        </div>
        <div class="btn-group">
            <button class="btn btn-outline btn-red dim"><i class="fa fa-thumbs-o-up" aria-hidden="true"></i> Like</button>
            <button class="btn btn-outline btn-red dim"><i class="fa fa-thumbs-o-down" aria-hidden="true"></i> Unlike</button>
        </div>
    </div>
</div>
<div class="row">
    <!-- <div class="col-12"> -->
    <div class="box-title">
        <h2>Comments:</h2>
    </div>
    <div class="box-content">
            {% for comment in comments %}
                {{ comment.render() | safe }}
            {% endfor %}
        <div class="post-comment">
            <div class="comment-body">
                <form role="form" class="form-inline" method="post" name="comment-form">
                    <textarea class="form-control" name="comment" placeholder="Write a comment..."></textarea>
                    <button class="btn btn-primary pull-right" type="submit"><i class="fa fa-commenting-o" aria-hidden="true"></i> Post Comment</button>
                </form>
            </div>
        </div>
    </div>
</div>


{% endblock %}






{% block tail_script %}
<script>

    const commentTextArea = document.querySelector('textarea');
    console.log(commentTextArea);

    const commentForm = document.querySelector('form');
    console.log(commentForm);

    commentTextArea.addEventListener('keydown', onTextAreaKeyDown, false);


    function onTextAreaKeyDown(e) {
        console.log(e);
        // console.log(e.target);
        console.log(e.key);
        // Is it the enter key?
        if (e.key === "Enter") {
         console.log("Enter key pressed!");
         commentForm.submit();
        }
        // if (e.key === "Shift") {
        //     console.log()
        // }
    }


    const editPostBtn = document.querySelector('button[name=edit-post]');
    console.log(editPostBtn);
    // editPostBtn.addEventListener('click', onEdit, false);

    const deletePostBtn = document.querySelector('button[name=delete-post]');
    console.log(deletePostBtn);
    deletePostBtn.addEventListener('click', onDelete, false);

    function onDelete(e) {
        console.log(e.target);
        console.log(this.dataset);
        const postId = this.dataset.id;
        console.log(postId);

        const path = '/' + postId + '/delete';
        console.log(path);

        // var xhr = new XMLHttpRequest();
        // xhr.open('POST', path, true);
        // xhr.send();

        // xhr.onreadystatechange = processRequest;

        post(path, {}, 'POST');
    }

    function onEdit(e) {
        console.log(e.target);
        console.log(this.dataset);
        const postId = this.dataset.id;
        console.log(postId);

        const path = '/' + postId + '/edit';
        console.log(path);

        // var xhr = new XMLHttpRequest();
        // xhr.open('GET', path, true);
        // xhr.send();

        // xhr.onreadystatechange = processRequest;

        post(path, {}, 'GET');
    }

    function processRequest(e) {
        if (xhr.readyState == 4 && xhr.status == 200) {
                // time to partay!!!
            console.log('time to partay!!');
            alert('Time to partay!');
        } else {
            console.log(e);
        }
    }

    function post(path, params, method) {
        method = method || "post"; // Set method to post by default if not specified.

        // The rest of this code assumes you are not using a library.
        // It can be made less wordy if you use one.
        var form = document.createElement("form");
        form.setAttribute("method", method);
        form.setAttribute("action", path);

        for(var key in params) {
            if(params.hasOwnProperty(key)) {
                var hiddenField = document.createElement("input");
                hiddenField.setAttribute("type", "hidden");
                hiddenField.setAttribute("name", key);
                hiddenField.setAttribute("value", params[key]);

                form.appendChild(hiddenField);
             }
        }

        document.body.appendChild(form);
        form.submit();
}

</script>
{% endblock tail_script %}